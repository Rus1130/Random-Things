<style>
    @import url('https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap');
    html {
        font-family: 'Lato', sans-serif;
    }
    #case-spinner-menu {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
        flex-direction: column;
    }

    #case-spinner {
        height: 350px;
        width: 700px;
        outline: 1px solid black;
        background: blue;
        display: grid;
        grid-template-columns: repeat(6, 1fr);    
        overflow: hidden;

    }

    .spinner-cell {
        height: 350px;
        width: 140px;
        outline: 1px solid black;
        display: flex;
        justify-content: center;
        align-items: center;
        transform: translateX(-140px);
    }

    #spin-again-button {
        height: 50px;
        width: 200px;
        margin-top: 20px;
        border: 1px solid orangered;
        border-radius: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: 700;
        color: white;
        background-color: orange;
        box-shadow: 0px 0px 20px 1px rgba(255, 69, 0, 0.75) inset;
        user-select: none;
    }

    #ticker {
        position: absolute;
        height: 351px;
        width: 5px;
        transform: translateY(-36px);
        background-color: rgba(0, 0, 0, 0.387);
        user-select: none;
    }

    #ui {
        position: fixed;
    }    


</style>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
</head>
<body>
    <div id="ui">
        <div id="money-counter">$100</div>
        <div id="current-case">Current Case: Shapes</div>
    </div>
    
    <div id="case-spinner-menu">
        <div id="case-spinner">
            <div class="spinner-cell" id="spinner-cell-1" style="background: green;">Extra</div>
            <div class="spinner-cell" id="spinner-cell-2">Start!</div>
            <div class="spinner-cell" id="spinner-cell-3">1</div>
            <div class="spinner-cell" id="spinner-cell-4">Middle!</div>
            <div class="spinner-cell" id="spinner-cell-5">2</div>
            <div class="spinner-cell" id="spinner-cell-6">End!</div>
        </div>
        <div id="ticker"></div>
        <div id="spin-again-button">Spin Again ($)</div>
    </div>
</body>
<script>
    const spinAgainButton = document.getElementById('spin-again-button');
    const caseSpinner = document.getElementById('case-spinner');

    let spinnerCell1 = document.getElementById('spinner-cell-1');
    let spinnerCell2 = document.getElementById('spinner-cell-2');
    let spinnerCell3 = document.getElementById('spinner-cell-3');
    let spinnerCell4 = document.getElementById('spinner-cell-4');
    let spinnerCell5 = document.getElementById('spinner-cell-5');
    let spinnerCell6 = document.getElementById('spinner-cell-6');

    let spinning = false;

    let currentCase = 'Shapes'

    let currentMoney = 100;

    // 0.5 + 0.29 + 0.15 + 0.03 + 0.02 + 0.01
    const probabilities = {
        common: 0.5,
        uncommon: 0.29,
        rare: 0.15,
        epic: 0.03,
        legendary: 0.02,
        mythical: 0.01
    }

    const colors = {
        common: '#b3b3b3',
        uncommon: '#00cc00',
        rare: '#ff6600',
        epic: '#cc00ff',
        legendary: '#ffcc00',
        mythical: '#ff0000'
    }

    const cases = {
        "Shapes": {
            cost: 8,
            common: { circle: 1 },
            uncommon: { triangle: 5 },
            rare: { square: 7 },
            epic: { star: 34 },
            legendary: { hexagon: 65 },
            mythical: { dodecagon: 138 }
        },

        "People": {
            cost: 45,
            common: { Noa: 10 },
            uncommon: { Ehren: 15 },
            rare: { Matthew: 39 },
            epic: { CT: 100 },
            legendary: { JT: 420 },
            mythical: { Jax: 669 }
        },

        "Teachers": {
            cost: 12,
            common: { Trudy: 4 },
            uncommon: { "Mrs. Philipp": 5 },
            rare: { "Mr. Cranston": 7 },
            epic: { "Mr. Jones": 50 },
            legendary: {"Ms. Hart": 120 },  
            mythical: { "Mr. Morrill": 280 },
        }
    }

    function setStartingLook(){
        let randomizations = [randomize(probabilities), randomize(probabilities), randomize(probabilities), randomize(probabilities), randomize(probabilities), randomize(probabilities)];
        spinnerCell1.innerHTML = Object.keys(cases[currentCase][randomizations[0]]).join("");
        spinnerCell2.innerHTML = Object.keys(cases[currentCase][randomizations[1]]).join("");
        spinnerCell3.innerHTML = Object.keys(cases[currentCase][randomizations[2]]).join("");
        spinnerCell4.innerHTML = Object.keys(cases[currentCase][randomizations[3]]).join("");
        spinnerCell5.innerHTML = Object.keys(cases[currentCase][randomizations[4]]).join("");
        spinnerCell6.innerHTML = Object.keys(cases[currentCase][randomizations[5]]).join("");

        spinnerCell1.rarity = randomizations[0];
        spinnerCell2.rarity = randomizations[1];
        spinnerCell3.rarity = randomizations[2];
        spinnerCell4.rarity = randomizations[3];
        spinnerCell5.rarity = randomizations[4];
        spinnerCell6.rarity = randomizations[5];

        spinnerCell1.style.background = colors[randomizations[0]];
        spinnerCell2.style.background = colors[randomizations[1]];
        spinnerCell3.style.background = colors[randomizations[2]];
        spinnerCell4.style.background = colors[randomizations[3]];
        spinnerCell5.style.background = colors[randomizations[4]];
        spinnerCell6.style.background = colors[randomizations[5]];
    }

    function switchCase(newCase){
        if(spinning) return;
        currentCase = newCase;
        document.getElementById('current-case').innerHTML = `Current Case: ${currentCase}`;
        spinAgainButton.innerHTML = `Spin Again ($${cases[currentCase].cost})`;
        setStartingLook();
    }
    const inventory = {};
    switchCase(currentCase);

    function randomize(prob) {
        let i
        let sum = 0
        let r = Math.random();
        for (i in prob) {
            sum += prob[i];
            if (r <= sum) return i;
        }
    }


    function animateSpinner(){
        let keyframes = [
            {transform: 'translateX(-140px)'},
            {transform: 'translateX(0px)'}
        ]

        let keyframeOptions = {
            duration: 100,
            iterations: 1,
            fill: 'forwards',
        }

        function changeValues(){
            let newRarity = randomize(probabilities);
            let temp = Object.keys(cases[currentCase][newRarity]).join("");
            spinnerCell6.innerHTML = spinnerCell5.innerHTML;
            spinnerCell5.innerHTML = spinnerCell4.innerHTML;
            spinnerCell4.innerHTML = spinnerCell3.innerHTML;
            spinnerCell3.innerHTML = spinnerCell2.innerHTML;
            spinnerCell2.innerHTML = spinnerCell1.innerHTML;
            spinnerCell1.innerHTML = temp;

            let tempColor = colors[newRarity];
            spinnerCell6.style.background = spinnerCell5.style.background;
            spinnerCell5.style.background = spinnerCell4.style.background;
            spinnerCell4.style.background = spinnerCell3.style.background;
            spinnerCell3.style.background = spinnerCell2.style.background;
            spinnerCell2.style.background = spinnerCell1.style.background;
            spinnerCell1.style.background = tempColor;
        }

        let randomSpin = Math.floor(Math.random() * 11) + 45;
        let randomDecelSpin = Math.floor(Math.floor(Math.random() * 10) + (randomSpin / 2) - 5);

        function spin(times){
            document.getElementById("spinner-cell-1").animate(keyframes, keyframeOptions);
            document.getElementById("spinner-cell-2").animate(keyframes, keyframeOptions);
            document.getElementById("spinner-cell-3").animate(keyframes, keyframeOptions);
            document.getElementById("spinner-cell-4").animate(keyframes, keyframeOptions);
            document.getElementById("spinner-cell-5").animate(keyframes, keyframeOptions);
            document.getElementById("spinner-cell-6").animate(keyframes, keyframeOptions).addEventListener('finish', () => {

                let newSpin = times - 1

                if(newSpin < randomDecelSpin){
                    keyframeOptions.duration *= 1.08
                }

                if(newSpin > 0){
                    spin(newSpin)
                    changeValues()
                }

                if(newSpin == 0){
                    keyframeOptions.duration = 30
                    let spunItem = document.getElementById("spinner-cell-3").innerHTML;
                    setTimeout(() => {
                        spinning = false
                        inventory[spunItem] = inventory[spunItem] ? inventory[spunItem] + 1 : 1;
                        console.log(inventory)
                    }, (randomDecelSpin * 100) - 2600)
                    return;
                }
            });
        }

        // get a random integer between 45 and 55
        spin(randomSpin)

    }
    
    spinAgainButton.addEventListener('click', () => {
        if(spinning) return;
        animateSpinner();
        spinning = true;
    });
</script>