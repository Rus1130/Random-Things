<style>
    div {
        font-family: Arial, Helvetica, sans-serif;
    }
    textarea {
        font-family: Arial, Helvetica, sans-serif;
        resize: none;
    }
    textarea:focus {
        outline: none;
    }

    #container {
        display: grid;
        row-gap: 1px;
        width: 300px;
        height: 400px;
    }
    #wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
    }
    #alert {
        width: 300px;
        height: 290px;
        border: 1px solid black;
        position: absolute;
        z-index: 100;
        background-color: white;
    }
    #alert-text {
        width: 100%;
        height: 100%;

        /*center the text*/
        text-align: center;
        /*center the text vertically*/
        display: flex;
        justify-content: center;
        align-items: center;
        
        font-size: calc(100% + 0.3vw);
    }



    #submitBetButton {
        width: calc(100% - 1);
        height: 50px;
        border: 1px solid black;
        background-color: rgb(159, 187, 247);
        transition: background-color 0.5s;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: calc(100% + 0.3vw);
        user-select: none;
    }
    #submitBetButton:hover {
        cursor: pointer;
        background-color: rgb(101, 150, 255);
    }

    #close {
        background-color: firebrick;   
        user-select: none;
        width: calc(100% + 2px);
        height: 50px;
        position: absolute;
        bottom: 0px;
        display: flex;
        justify-content: center;
        align-items: center;
        /*scale the font size with the size of #close */
        font-size: 30px;

        transition: background-color 0.5s;
    }
    #close:hover {
        background-color: rgb(210, 26, 26);
        cursor: pointer;
    }

    .hidden {
        display: none;
    }

    #bet-on {
        font-size: 20px;
    }

    #bet-amount {
        font-size: 20px;
    }

    #moneyCounter {
        text-align: center;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        transform: translate(0, -25px);
        font-size: 20px;
    }

    #helper {
        position: absolute;
        font-size: 20px;
    }

    #bankingMenu, #statsMenu {
        width: 500px;
        height: 500px;
        position: absolute;
        z-index: 1;
        background-color: white;
        border: 1px black solid;
        font-size: 20px;
    }

    #bankingMenuInner {
        width: 100%;
        height: 100%;
        display: grid;
        grid-template-columns: 100%;
        grid-template-rows: 1fr 1fr 1fr 1fr;
        text-align: center;
    }

    #centerer {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
    }

    #depositButton, #withdrawButton {
        width: calc(100% - 2px);
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 20px;
        user-select: none;
        background-color: rgb(159, 187, 247);
        transition: background-color 0.5s;
        border: 1px solid black;
    }

    #depositButton:hover, #withdrawButton:hover {
        cursor: pointer;
        background-color: rgb(101, 150, 255);
    }

</style>
<head>
    <!--add interest-cohort -->
    <meta http-equiv="interest-cohort" content="default=()"/>
    <script src="math.js"></script>
</head>
<body>
    <div id="helper">
        e to open banking menu<br>
        o to open stats menu<br>
        l to open loans menu<br>
    </div>
    <div id="wrapper">
        <div id="alert" class="hidden">
            <div id="alert-text"></div>
            <div id="close" onclick="closeAlertBox()">X</div>
        </div>
        <div id="container">
            <div id="moneyCounter">Bet Money: $100</div>
            <textarea placeholder="what you bet on (red, black, or a number)" id="bet-on"></textarea>
            <textarea placeholder="your bet" id="bet-amount"></textarea>
            <div id="submitBetButton" onclick="submitBet()">Bet!</div>
        </div>
        <div id="bankingMenu" gameMenu class="hidden">
            <div id='centerer'>
                <div style="display: grid; row-gap: 4px; text-align: center;">
                    <div id="bankedMoneyDisplay">Account Balance: $0</div>
                    <textarea placeholder="Enter the amount" id="bankAmountInput" style="font-size: 20px; height: 1.5em;"></textarea>
                    <div id="depositButton" onclick="bankMoneyController('add', bankAmountInput.value)">Deposit</div>
                    <div id="withdrawButton" onclick="bankMoneyController('sub', bankAmountInput.value)">Withdraw</div>
                </div>
            </div>
        </div>
        <div id="statsMenu" gameMenu class="hidden">
            <div id='wrapper' style="text-align: center;">
                Wins: 0<br>
                Losses: 0<br>
                Money won: $0<br>
                Money lost: $0<br>
                Times you went into debt: 0<br>
                Numbers landed: 0<br>
                Numbers Missed: 0<br>
                Colors landed: 0<br>
                Colors missed: 0
            </div>
        </div>
    </div>

</body>
<head>

</head>
<script>
    const alertBox = document.getElementById('alert')
    const alertText = document.getElementById('alert-text')
    const closeButton = document.getElementById('close')

    const betAmountElem = document.getElementById('bet-amount')
    const betOnElem = document.getElementById('bet-on')

    const moneyCounter = document.getElementById('moneyCounter')
    const bankingMenu = document.getElementById('bankingMenu')

    const statsElem = document.getElementById('statsMenu')

    const bankedMoneyDisplay = document.getElementById('bankedMoneyDisplay')

    const bankAmountInput = document.getElementById('bankAmountInput')

    function closeAlertBox(){
        alertBox.classList.add('hidden')
    }

    function bankMoneyController(type, amount){
        // check if amount is a number
        if (amount == '' || isNaN(amount)){
            alertText.innerHTML = 'You must bet a number.'
            betAmountElem.value = ''
            alertBox.classList.remove('hidden')
            return
        }

        amount = parseInt(amount)

        if(type == 'add'){
            if(gameData.playerMoney < amount){
                alertText.innerHTML = "You can't bank what you don't have."
                alertBox.classList.remove('hidden')
            } else {
                gameData.playerMoney -= amount
                gameData.bankedMoney += amount
                moneyCounter.innerHTML = `Bet Money: $${gameData.playerMoney}`
                bankedMoneyDisplay.innerHTML = `Account Balance: $${gameData.bankedMoney}`
            }
        } else if(type == "sub"){
            if(gameData.bankedMoney < amount){
                alertText.innerHTML = "You can't withdraw what you don't have."
                alertBox.classList.remove('hidden')
            } else {
                gameData.playerMoney += amount
                gameData.bankedMoney -= amount
                moneyCounter.innerHTML = `Bet Money: $${gameData.playerMoney}`
                bankedMoneyDisplay.innerHTML = `Account Balance: $${gameData.bankedMoney}`
            }
        }

        setAllDisplays()
    }

    function menuController(menu){
        let menus = document.querySelectorAll('[gameMenu]')
        menus.forEach(element => {
            if(element.id != menu && !element.classList.contains('hidden')) element.classList.add('hidden')
            if(menu == element.id) element.classList.toggle('hidden')
        });
    }

    const stats = {
        Wins: 0,
        Losses: 0,
        Money_won: 0,
        Money_lost: 0,
        Times_you_went_into_debt: 0,
        Numbers_landed: 0,
        Numbers_missed: 0,
        Colors_landed: 0,
        Colors_missed: 0,
    }

    const gameData = {
        bank: 0,
        playerMoney: 100,
        bankedMoney: 0,
        maxLoan: 1000,
        hasLoan: false,
        loanTimer: 0,
    }

    if (localStorage.getItem('roulette_stats') != null) {
        let keys = Object.keys(JSON.parse(localStorage.getItem('roulette_stats')));
        keys.forEach(key => {
            stats[key] = JSON.parse(localStorage.getItem('roulette_stats'))[key]
        })
    }

    if (localStorage.getItem('roulette_gameData') != null) {
        let keys = Object.keys(JSON.parse(localStorage.getItem('roulette_gameData')));
        keys.forEach(key => {
            gameData[key] = JSON.parse(localStorage.getItem('roulette_gameData'))[key]
        })
    }

    function setAllDisplays(){
        let statBuffer = ''

        for(let stat in stats){
            statBuffer += `${stat}: ${stat == "Money_won" || stat == "Money_lost" ? "$" : ""}${stats[stat]}<br>`
        }

        statBuffer = `<div id='wrapper' style="font-size: 20px; text-align: center;">${statBuffer}</div>`
        statsElem.innerHTML = statBuffer.replaceAll("_", " ")

        moneyCounter.innerHTML = `Bet Money: $${gameData.playerMoney}`
        bankedMoneyDisplay.innerHTML = `Account Balance: $${gameData.bankedMoney}`
    }

    setAllDisplays()

    const numbers = {
        0: 'green',
        32: 'red',
        15: 'black',
        19: 'red',
        4: 'black',
        21: 'red',
        2: 'black',
        25: 'red',
        17: 'black',
        34: 'red',
        6: 'black',
        27: 'red',
        13: 'black',
        36: 'red',
        11: 'black',
        30: 'red',
        8: 'black',
        23: 'red',
        10: 'black',
        5: 'red',
        24: 'black',
        16: 'red',
        33: 'black',
        1: 'red',
        20: 'black',
        14: 'red',
        31: 'black',
        9: 'red',
        22: 'black',
        18: 'red',
        29: 'black',
        7: 'red',
        28: 'black',
        12: 'red',
        35: 'black',
        3: 'red',
        26: 'black'
    }

    function submitBet(){
        betOnElem.value = betOnElem.value.trim()
        betAmountElem.value = betAmountElem.value.trim()

        
        let betOn = betOnElem.value
        let betAmount = betAmountElem.value

        let redNumbers = Object.keys(numbers).filter(key => numbers[key] == 'red')
        let blackNumbers = Object.keys(numbers).filter(key => numbers[key] == 'black')

        if (betAmount == '' || isNaN(betAmount)){
            alertText.innerHTML = 'You must bet a number.'
            betAmountElem.value = ''
            alertBox.classList.remove('hidden')
            return
        }

        betAmount = parseInt(betAmount)

        if(betAmount > gameData.playerMoney || gameData.playerMoney == 0){
            alertText.innerHTML = "You can't bet what you don't have."
            betAmountElem.value = ''
            alertBox.classList.remove('hidden')
            return
        }

        if (betOn != 'red' && betOn != 'black' && betOn != 'green'){
            if(!redNumbers.includes(betOn) && !blackNumbers.includes(betOn)){
                alertText.innerHTML = 'You must bet on red, black, or a number.'
                betOnElem.value = ''
                alertBox.classList.remove('hidden')
                return
            }
        }

        // get a random number, but weight it against landing on the color the user bet on

        let unweightedSpunNumber = Math.floor(Math.random() * 37)


        function weightedRand(spec) {
            var i, j, table=[];
            for (i in spec) {
                for (j=0; j<spec[i]*10; j++) {
                    table.push(i);
                }
            }
            return function() {
                return table[Math.floor(Math.random() * table.length)];
            }
        }

        let weights = {}
        for(i = 1; i <= 36; i++){
            weights[i] = math.round(1/36, 6)
        }

        for(let key in weights){
            if(key == unweightedSpunNumber){
                weights[key] -= 0.017778
            } else {
                weights[key] += 0.017778
            }
        }



        let spinNumber = weightedRand(weights)
        let spunNumber = spinNumber()

        

        let unweightedSpunColor = numbers[spunNumber]
        let colorWeights = {
            red: 0.499995,
            black: 0.499995,
            green: 0.00001
        }

        // chance the probability of landing on the color the user bet on
        for(let key in colorWeights){
            if(key == 'green') continue;
            if(key == unweightedSpunColor){
                colorWeights[key] -= 0.099995
            } else {
                colorWeights[key] += 0.099995
            }
        }

        let spinColor = weightedRand(colorWeights)
        let spunColor = spinColor()

        if(unweightedSpunColor == 'green'){
            spunColor = 'green'
        }

        alertBox.classList.remove('hidden')


        // check if betOn was a number or the colors
        if(betOn == "red" || betOn == 'black' || betOn == 'green'){
            if(betOn == spunColor){
                if(betOn == 'green'){
                    alertText.innerHTML = `You bet $${betAmount} on ${betOn} and won! You got $${betAmount * 17}!`
                    gameData.playerMoney += betAmount * 17
                    stats.Colors_landed += 1
                    stats.Money_won += betAmount * 17
                    stats.Wins += 1
                } else {
                    alertText.innerHTML = `You bet $${betAmount} on ${betOn} and won! You got $${betAmount}.`
                    gameData.playerMoney += betAmount
                    stats.Colors_landed += 1
                    stats.Money_won += betAmount
                    stats.Wins += 1
                }

            } else {
                alertText.innerHTML = `You bet $${betAmount} on ${betOn} and lost. You lost $${betAmount}.`
                gameData.playerMoney -= betAmount
                stats.Colors_missed += 1
                stats.Money_lost += betAmount
                stats.Losses += 1

                gameData.bank += Math.round(betAmount * 3.5)
            }
        } else {
            if(betOn == spunNumber){
                alertText.innerHTML = `You bet $${betAmount} on ${betOn} and won! You got $${betAmount * 35}!`
                gameData.playerMoney += betAmount * 35
                stats.Numbers_landed += 1
                stats.Money_won += betAmount * 35
                stats.Wins += 1
            } else {
                alertText.innerHTML = `You bet $${betAmount} on ${betOn} and lost. You lost $${betAmount}.`
                gameData.playerMoney -= betAmount
                stats.Numbers_missed += 1
                stats.Money_lost += betAmount
                stats.Losses += 1

                gameData.bank += Math.round(betAmount * 3.5)
            }
        }



        setAllDisplays()
    }

    let deleteCounter = 0;
    let savelock = false;


    document.addEventListener('keydown', function(event){
        // do nothing if the user is typing in an input
        if(document.activeElement.tagName == 'TEXTAREA') return;


        if(event.key == 'e'){
            menuController("bankingMenu")
        }
        if(event.key == 'o'){
            menuController("statsMenu")
        }
        // check if Delete was pressed 3 times within 500ms
        
        if(event.key == 'Delete'){
            savelock = true;
            if(deleteCounter == 0){
                deleteCounter = 1
                setTimeout(function(){
                    deleteCounter = 0
                    savelock = false;
                }, 800)
            } else if(deleteCounter == 1){
                deleteCounter = 2
                setTimeout(function(){
                    deleteCounter = 0
                    savelock = false;
                }, 800)
            } else if(deleteCounter == 2){
                deleteCounter = 0
                let resetDataConfirmation = confirm('Are you sure you want to reset your data?')
                if(resetDataConfirmation){
                    localStorage.removeItem('roulette_gameData')
                    localStorage.removeItem('roulette_stats')
                    location.reload()
                }
            }
        }
    })

    // on unload, save the game data
    window.onbeforeunload = function(){
        if(!savelock){
            localStorage.setItem('roulette_gameData', JSON.stringify(gameData))
            localStorage.setItem('roulette_stats', JSON.stringify(stats))
        }
    }




</script>

<!--credits to mattkoco-->