<style>
</style>
<head>

</head>
<body>
encryption:<br>
Input: <textarea id="en-in"></textarea><br>
output value: <div id="en-oval"></div><br>
<button id="encryptButton">Encrypt</button><br>
output key: <div id="en-okey"></div><br><br>
decryption:<br>
value: <textarea id="de-val"></textarea><br>
key: <textarea id="de-key"></textarea><br>
<button id="decryptButton">Decrypt</button><br>
output: <div id="de-out"></div>
</body>
<script>

    const base60 = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x']

    function toBase60(num){
        let result = '';
        while(num > 0){
            result = base60[num % 60] + result;
            num = Math.floor(num / 60);
        }
        result = result || "0";
        return result;
    }

    function fromBase60(str){
        let result = 0;
        for(i = 0; i < str.length; i++){
            result += base60.indexOf(str[i]) * Math.pow(60, str.length - i - 1);
        }
        return result;
    }

    let encryptionValue = document.getElementById('en-in');
    let encryptionOutputValue = document.getElementById('en-oval');
    let encryptionOutputKey = document.getElementById('en-okey');
    let decryptionValue = document.getElementById('de-val');
    let decryptionKey = document.getElementById('de-key');
    let decryptionOutput = document.getElementById('de-out');   

    let encryptButton = document.getElementById('encryptButton');
    let decryptButton = document.getElementById('decryptButton');

    function encrypt(value){
        let charPatterns = {
            "A": 3,
            "B": 2,
            "C": 4,
            "D": 5,
            "E": 1,
        }

        let shiftPatterns = {
            "A": 2,
            "B": 4,
            "C": 5,
            "D": 1,
            "E": 3,
        }

        let charPattern = Object.keys(charPatterns)[Math.floor(Math.random() * Object.keys(charPatterns).length)];
        let charVals = value.split('').map(char => char.charCodeAt(0) + 300);


        let shiftPattern = Object.keys(shiftPatterns)[Math.floor(Math.random() * Object.keys(shiftPatterns).length)];


        let shiftVals = [];

        for(i = 0; i < charVals.length; i++){
            shiftVals.push((charVals[i] >> 5));
        }

        charVals = charVals.map((char, index) => (char - (shiftVals[index] << 5)));

        let mixedVals = [];

        for(i = 0; i < shiftVals.length; i++){
            mixedVals.push([toBase60(shiftVals[i] ^ shiftPatterns[shiftPattern]), toBase60(charVals[i] ^ charPatterns[charPattern])]);
        }


        let key = `${shiftPattern}${charPattern}`;
        let body = ``;
        
        for(i = 0; i < mixedVals.length; i++){
            key += mixedVals[i][0];
            body += mixedVals[i][1];
        }

        body = body.split("")

        for(j = 0; j < body.length; j++){
            // random from 1 and 20
            let val = Math.floor(Math.random() * 20) + 1;
            body[j] = toBase60(fromBase60(body[j]) + val)
            key += toBase60(val)
        }

        body = body.join("")

        let result = {
            body: body,
            key: key,
        }

        return result;

        // ((fromBase60(keyVal) ^ shiftPatterns[firstPattern]) << 5) + (fromBase60(bodyVal) ^ charPatterns[secondPattern]) - 300
    }

    let charPatterns = {
        "A": 3,
        "B": 2,
        "C": 4,
        "D": 5,
        "E": 1,
    }

    let shiftPatterns = {
        "A": 2,
        "B": 4,
        "C": 5,
        "D": 1,
        "E": 3,
    }

    function decrypt(body, key){

        let charPatterns = {
            "A": 3,
            "B": 2,
            "C": 4,
            "D": 5,
            "E": 1,
        }

        let shiftPatterns = {
            "A": 2,
            "B": 4,
            "C": 5,
            "D": 1,
            "E": 3,
        }

        // split key into two arrays
        let firstPattern = key[0];
        let secondPattern = key[1];

        let keyArray = key.split("").slice(2);
        let length = keyArray.length;

        let keyVal = key.slice(2, length / 2 + 2);
        let randomVals = key.slice(length / 2 + 2, length);

        console.log(keyVal, randomVals)

        // ((fromBase60(keyVal) ^ shiftPatterns[firstPattern]) << 5) + (fromBase60(bodyVal) ^ charPatterns[secondPattern]) - 300
    }


    let encrypted = encrypt("Hello, World!")

    console.log(encrypted)
    console.log(decrypt(encrypted.body, encrypted.key))

</script>