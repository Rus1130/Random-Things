<style>
    html {
        font-family: monospace;
    }
</style>
<head>

</head>
<body>
encryption:<br>
Input: <textarea id="en-in"></textarea><br>
<button id="encryptButton">Encrypt</button><br>
output value: <div id="en-oval"></div><br>
output key: <div id="en-okey"></div><br><br>
decryption:<br>
value: <textarea id="de-val"></textarea><br>
key: <textarea id="de-key"></textarea><br>
<button id="decryptButton">Decrypt</button><br>
output: <div id="de-out"></div>
</body>
<script>

    const base60 = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x']

    function toBase60(num){
        let result = '';
        while(num > 0){
            result = base60[num % 60] + result;
            num = Math.floor(num / 60);
        }
        result = result || "0";
        return result;
    }

    function fromBase60(str){
        let result = 0;
        if(str == undefined) return "0";
        for(i = 0; i < str.length; i++){
            result += base60.indexOf(str[i]) * Math.pow(60, str.length - i - 1);
        }
        return result;
    }

    let encryptionValue = document.getElementById('en-in');
    let encryptionOutputValue = document.getElementById('en-oval');
    let encryptionOutputKey = document.getElementById('en-okey');
    let decryptionValue = document.getElementById('de-val');
    let decryptionKey = document.getElementById('de-key');
    let decryptionOutput = document.getElementById('de-out');   

    let encryptButton = document.getElementById('encryptButton');
    let decryptButton = document.getElementById('decryptButton');

    encryptButton.addEventListener('click', () => {
        let result = encrypt(encryptionValue.value);
        encryptionOutputValue.innerHTML = result.body;
        encryptionOutputKey.innerHTML = result.key;
    })

    decryptButton.addEventListener('click', () => {
        let result = decrypt(decryptionValue.value, decryptionKey.value);
        decryptionOutput.innerHTML = result;
    })

    function encrypt(value){
        let charPatterns = {
            "A": 7,
            "B": 5,
            "C": 3,
            "D": 1,
            "E": 2,
            "F": 4,
            "G": 6,
        }

        let shiftPatterns = {
            "A": 6,
            "B": 7,
            "C": 4,
            "D": 5,
            "E": 3,
            "F": 1,
            "G": 2,
        }

        let charPattern = Object.keys(charPatterns)[Math.floor(Math.random() * Object.keys(charPatterns).length)];
        let charVals = value.split('').map(char => char.charCodeAt(0) + 300);


        let shiftPattern = Object.keys(shiftPatterns)[Math.floor(Math.random() * Object.keys(shiftPatterns).length)];


        let shiftVals = [];

        for(i = 0; i < charVals.length; i++){
            shiftVals.push((charVals[i] >> 5));
        }

        charVals = charVals.map((char, index) => (char - (shiftVals[index] << 5)));

        let mixedVals = [];

        for(i = 0; i < shiftVals.length; i++){
            mixedVals.push([toBase60(shiftVals[i] ^ shiftPatterns[shiftPattern]), toBase60(charVals[i] ^ charPatterns[charPattern])]);
        }


        let key = `${shiftPattern}${charPattern}`;
        let body = ``;
        
        for(i = 0; i < mixedVals.length; i++){
            key += mixedVals[i][0];
            body += mixedVals[i][1];
        }

        body = body.split("")
        randomVals = [];

        for(j = 0; j < body.length; j++){
            // random from 1 and 20
            let val = Math.floor(Math.random() * 20) + 1;
            body[j] = toBase60(fromBase60(body[j]) + val)
            key += toBase60(val)
        }

        body = body.join("")

        let result = {
            body: body,
            key: key,
        }

        return result;

        // ((fromBase60(keyVal) ^ shiftPatterns[firstPattern]) << 5) + ((fromBase60(bodyVal)-fromBase60(randVal)) ^ charPatterns[secondPattern]) - 300
    }

    function decrypt(body, key){

        function decryptSingle(bodyVal, keyVal, randVal, firstPattern, secondPattern){
            return ((fromBase60(keyVal) ^ shiftPatterns[firstPattern]) << 5) + ((fromBase60(bodyVal)-fromBase60(randVal)) ^ charPatterns[secondPattern]) - 300
        }

        let charPatterns = {
            "A": 7,
            "B": 5,
            "C": 3,
            "D": 1,
            "E": 2,
            "F": 4,
            "G": 6,
        }

        let shiftPatterns = {
            "A": 6,
            "B": 7,
            "C": 4,
            "D": 5,
            "E": 3,
            "F": 1,
            "G": 2,
        }

        // split key into two arrays
        let firstPattern = key[0];
        let secondPattern = key[1];

        key = key.slice(2).split("");

        // split key array into two
        let keyArray = key.slice(0, key.length / 2);
        let randArray = key.slice(key.length / 2);
        let bodyArray = body.split("");

        let result = '';

        for(j = 0; j < bodyArray.length; j++){
            result += String.fromCharCode(decryptSingle(bodyArray[j], keyArray[j], randArray[j], firstPattern, secondPattern));
        }

        return result;

    }


    let encrypted = encrypt("Hello, World!")

    console.log(encrypted)
    console.log(decrypt(encrypted.body, encrypted.key))

</script>