<style>
    textarea {
        position: relative;
        height: 700px;
        width: 400px;
        resize: none;
        font-family: monospace;
        border: 1.5px black solid;
        color: black;
        border-radius: 0%;
        font-size: 12pt;
    }
    textarea:focus {
        border: 1.5px black solid;
        outline: none;
    }
    #layout {
        display: grid;
        grid-template-columns: repeat(2, 400px);
        column-gap: 5px;
    }
    #output {
        display: grid;
        grid-template-columns: repeat(100, 10px);
        grid-template-rows: repeat(100, 10px);
        width: 1000px;
        height: 1000px;
        border: 1.5px black solid;
    }
    #run-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: monospace;
        border: 1px solid black;
        font-size: 15px;
        background-color: beige;
        width: 400px;
        height: 60px;
        top: -280px;
        font-size: 20px;
        transition: ease 0.3s;
        position: relative;
    }
    #run-btn:hover {
        background-color: #f0f0f0;
    }
</style>
<head>

</head>
<body>
    <div id="layout">
        <textarea id="input" spellcheck="false"></textarea>
        <div id="output"></div>
    </div>
    <button id="run-btn" onclick="run(input.value)">Run!</button>
</body>
<script>
    const input = document.getElementById("input")
    const output = document.getElementById('output')
    
    let pointer = {
        x: 0,
        y: 0
    }
    let max_X = 100
    let max_Y = 100
    // setup
    function setup(){
        for(i = 0; i < max_X; i++){
            for(j = 0; j < max_Y; j++){
                let cell = document.createElement('div')
                cell.style.backgroundColor = '#FFFFFF'
                cell.style.fontSize = '5px'
                cell.style.fontFamily = 'monospace'
                cell.style.width = '10px'
                cell.style.height = '10px'
                cell.id = `${j},${i}`
                output.appendChild(cell)
            }
        }
        output.style.transform = 'rotate(-90deg)'
        modCurrentCell(false,pointer.x,pointer.y)
    }

    function fixIllegalXY(){
        if(pointer.x > max_X){
            pointer.x = max_X
        }
        if(pointer.x < 0){
            pointer.x = 0
        }
        if(pointer.y > max_Y){
            pointer.y = max_Y
        }
        if(pointer.y < 0){
            pointer.y = 0
        }
    }

    const colorsArray = {
        0: "#0a544f",
        1: "#0d6a73",
        2: "#14783c",
        3: "#1a869c",
        4: "#263847",
        5: "#3da3bf",
        6: "#459c28",
        7: "#52002d",
        8: "#565876",
        9: "#654c68",
        10: "#682e2e",
        11: "#72847f",
        12: "#79cfd9",
        13: "#823fa1",
        14: "#861008",
        15: "#8bb842",
        16: "#8f5931",
        17: "#a4b2a0",
        18: "#a6834e",
        19: "#ab63d4",
        20: "#b54b12",
        21: "#b60e2d",
        22: "#bfedf2",
        23: "#d4821e",
        24: "#d9d4c4",
        25: "#dc2828",
        26: "#e573cf",
        27: "#ee9481",
        28: "#f6d884",
        29: "#ffaef8",
        30: "#ffc9bd",
        31: "#ffffff"
    }
    
    function colorArraySort(){
        let result = []
        let temp = []
        for(i = 0; i < colorsArray.length; i++){
            temp.push(parseInt(colorsArray[i],16))
        }
        result = temp.sort(function(a, b) {
            return a - b;
        });
        result = result.map(x => "#" + x.toString(16).padStart(6, "0"));
        return result
    }

    function modCurrentCell(clearMode,x,y){
        let cell = document.getElementById(`${y ?? 0},${x ?? 0}`)
        if(clearMode == true){
            cell.style.borderLeft = 'none'
        } else {
            cell.style.borderLeft = '1px black solid'
        }
    }
    
    setup()

    function timeout(ms) {
        return new Promise(resolve => setTimeout(resolve, ms))
    }

    async function run(instructions){
        output.innerHTML = ''
        setup()
        let input = ["q"].concat(instructions.replaceAll("\n","").split(""))
        for(i = 0; i < input.length; i++){
            console.log(pointer)
            fixIllegalXY()
            modCurrentCell(true,pointer.x,pointer.y)
            let currentChar = input[i]
            let nextChar = input[i + 1]
            if(currentChar == "q"){
                modCurrentCell(true,pointer.x,pointer.y)
                pointer.x = 0
                pointer.y = 0
                modCurrentCell(false,pointer.x,pointer.y)
            }
            if(currentChar == "+" || currentChar == "-"){
                if(nextChar == "{" || nextChar == "("){
                    let matchingIndexParen = input.indexOf(")",i)
                    let matchingIndexCurly = input.indexOf("}",i)
                    if(matchingIndexParen != -1){
                        let matchingValue = parseInt(instructions.slice(i + 1,matchingIndexParen - 1))
                        if(currentChar == "+"){
                            pointer.x += matchingValue
                        } else {
                            pointer.x -= matchingValue
                        }

                    } else if(matchingIndexCurly != -1){
                        let matchingValue = parseInt(instructions.slice(i + 2,matchingIndexCurly))
                        if(currentChar == "+"){
                            pointer.y += matchingValue
                        } else {
                            pointer.y -= matchingValue
                        }
                    }
                }
            }
            timeout(500)
            modCurrentCell(false,pointer.x,pointer.y)
            fixIllegalXY()
            
        }
    }

    

</script>