<style>
    #player {
        width: 50px;
        height: 50px;
        background-color: red;
        position: absolute;
        border-radius: 50%;
        top: 0;
        left: 0;
    }

    body {
        overflow: hidden;
    }

    #key-wrapper, #key-input-wrapper {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: fit-content;
        height: fit-content;
        border: 1px solid black;
        padding: 10px;
        display: none;
        background-color: white;
    }

    #copy-key-button, #set-key-button {
        cursor: pointer;
        margin-top: -10px;
        text-align: center;
        background-color: #f0f0f0;
        padding: 5px;
        border: 1px solid black;
        user-select: none;
    }

    #key-input {
        border: 1px solid black;
        padding: 5px;
    }

    #key-input:focus {
        outline: none;
    }


</style>
<head>
    <script src="../shooter/math.js"></script>
    <script src="../computers/encryption.js"></script>
</head>
<body>
    <div id="field">
        <div id="player"></div>
    </div>
    <div id="key-wrapper">
        Your key:<br>
        <div id="key">#####</div>
        <br>
        <div id="copy-key-button" onclick="copyKeyToClipboard()">Copy Key</div>
    </div>
    <div id="key-input-wrapper">
        Input key here: <div id="key-input" contenteditable="true"></div>
        <br>
        <div id="set-key-button" onclick="setKey(keyInput.innerText)">submit</div>
    </div>
    </div>
</body>
<script>

    let e = new Encryption();

    let data = {
        x: 0,
        y: 0,
        vx: 0,
        vy: 0,
        inventory: {},
        xp: 0,
        keys: {}
    }
    const player = document.getElementById('player');

    const keyDisplay = document.getElementById('key-wrapper');
    const inputDisplay = document.getElementById('key-input-wrapper');
    const keyInput = document.getElementById('key-input');
    const rawKey = document.getElementById('key');

    function move(){
        if(data.keys["w"]) data.vy -= 1;
        if(data.keys["s"]) data.vy += 1;
        if(data.keys["a"]) data.vx -= 1;
        if(data.keys["d"]) data.vx += 1;


        data.vx = math.round(data.vx * 0.9, 4);
        data.vy = math.round(data.vy * 0.9, 4);

        data.x += data.vx;
        data.y += data.vy;

        data.x = math.round(data.x);
        data.y = math.round(data.y);

        player.style.left = data.x + "px";
        player.style.top = data.y + "px";

        if(data.x < 0) data.x = 0;
        if(data.y < 0) data.y = 0;
        if(data.x > window.innerWidth - 50) data.x = window.innerWidth - 50;
        if(data.y > window.innerHeight - 50) data.y = window.innerHeight - 50;

        // key creation
        let dataX = data.x.toString(26).replace("-", "").padStart(3, "0");
        let dataY = data.y.toString(26).replace("-", "").padStart(3, "0");


        let encrypted = e.encrypt(dataX + dataY);
        rawKey.innerText = encrypted.body + ":" + encrypted.key;

    }

    function copyKeyToClipboard(){
        let key = rawKey.innerText;
        navigator.clipboard.writeText(key);
    }

    function setKey(_key){
        let key = e.decrypt(_key.split(":")[0], _key.split(":")[1]);
        console.log(key)
        let x = parseInt(key.slice(0, 3), 26);
        let y = parseInt(key.slice(3, 6), 26);

        data.x = x;
        data.y = y;

        player.style.left = data.x + "px";
        player.style.top = data.y + "px";
    }



    setInterval(move, 15); //15
    // create a movement script
    document.addEventListener('keydown', function(event) {
        data.keys[event.key] = true;
        if(data.keys["p"]) keyDisplay.style.display = keyDisplay.style.display == "block" ? "none" : "block";
        if(data.keys["o"]) inputDisplay.style.display = inputDisplay.style.display == "block" ? "none" : "block";
    
    });

    document.addEventListener('keyup', function(event) {
        data.keys[event.key] = false;
    });
</script>