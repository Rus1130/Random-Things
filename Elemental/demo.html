<style>

</style>
<head>
    <script src="elemental.js"></script>
</head>
<body>
    http://127.0.0.1:5501/Elemental/demo.html<br>
    <textarea id="input-simplify"></textarea><br>
    <div id="output-simplify"></div>

    <textarea id="input-balance"></textarea>
    <div id="output-balance"></div>
</body>
<script defer>
    document.getElementById("input-simplify").oninput = function(){
        document.getElementById("output-simplify").textContent = Elemental.simplify(document.getElementById("input-simplify").value, {joinedResult: true, resultOnly: true });
    }

    document.getElementById("input-balance").oninput = function(){
        let input = document.getElementById("input-balance");
        let output = document.getElementById("output-balance");

        let balanced = Elemental.balance(input.value, {quantifyResult: true});
        if(typeof balanced === 'string') return output.textContent = balanced;
        else {
            output.textContent = Elemental.balance(input.value, {stringified: true});
            
            let excessElements = [];
            let generatedElements = [];
            let usedElements = [];

            let mana = 0;
            for(i = 0; i < Object.keys(balanced.excess).length;i++){
                for(j = 0; j < balanced.excess[Object.keys(balanced.excess)[i]];j++){
                    excessElements.push(Object.keys(balanced.excess)[i]);
                }
            }
            for(i = 0; i < Object.keys(balanced.generated).length;i++){
                for(j = 0; j < balanced.generated[Object.keys(balanced.generated)[i]];j++){
                    generatedElements.push(Object.keys(balanced.generated)[i]);
                }
            }
            for(i = 0; i < Object.keys(balanced.used).length;i++){
                for(j = 0; j < balanced.used[Object.keys(balanced.used)[i]];j++){
                    usedElements.push(Object.keys(balanced.used)[i]);
                }
            }

            for(i = 0; i < excessElements.length; i++){
                excessElements[i] = Elemental.get(excessElements[i]).atomicMass
            }

            for(i = 0; i < generatedElements.length; i++){
                generatedElements[i] = Elemental.get(generatedElements[i]).atomicMass
            }

            for(i = 0; i < usedElements.length; i++){
                usedElements[i] = Elemental.get(usedElements[i]).atomicMass
            }

            let totalGeneratedAtomicMass = 0;
            let totalExcessAtomicMass = 0;
            let totalUsedAtomicMass = 0;
            for(i = 0; i < generatedElements.length; i++){
                totalGeneratedAtomicMass += generatedElements[i];
            }
            for(i = 0; i < excessElements.length; i++){
                totalExcessAtomicMass += excessElements[i];
            }
            for(i = 0; i < usedElements.length; i++){
                totalUsedAtomicMass += usedElements[i];
            }

            mana = Math.abs(totalExcessAtomicMass - totalGeneratedAtomicMass)

            console.log(mana);

            
        }
    }
</script>