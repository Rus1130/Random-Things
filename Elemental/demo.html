<style>
</style>
<head>
    <script src="elemental.js"></script>
    <script src="../WikiUtil/Utils.js"></script>
</head>
<body>
    http://127.0.0.1:5501/Elemental/demo.html<br>
    <textarea id="input-simplify"></textarea><br>
    <div id="output-simplify"></div>

    <textarea id="input-balance"></textarea>
    <div id="output-balance"></div>
</body>
<script defer>
    let inputSimplify = document.getElementById("input-simplify");
    let outputSimplify = document.getElementById("output-simplify");

    inputSimplify.oninput = function(){
        outputSimplify.textContent = Elemental.simplify(inputSimplify.value, {joinedResult: true, resultOnly: true });
    }

    let inputBalance = document.getElementById("input-balance");
    let outputBalance = document.getElementById("output-balance");

    inputBalance.oninput = function(){
        console.log(Elemental.balance(inputBalance.value, {joinedResult: true, resultOnly: true}))
        outputBalance.textContent = Elemental.balance(inputBalance.value, {joinedResult: true, resultOnly: true});
    }
</script>
<script defer>
    Utils.addMixin("shared", {
        "min-height": "50px",
        width: "50%",
        fontSize: "18px",
    })
    let input = Utils.create("textarea", {
        include: "shared",
        resize: "none",
        placeholder: "Input goes here... (ex. C6H12O6 + O2 -> CO2 + H2O)",
    })
    let output = Utils.create("div", {
        include: "shared",
        textContent: "Output",
        'margin-top': '5px',
        border: "1px solid black",
        display: 'flex',
        'align-items': 'center',
        'justify-content': 'center',
    })


    input.oninput = function(){
        output.textContent = Elemental.simplify(input.value, {joinedResult: true, resultOnly: true });
    }

    input.oninput = function(){
        let balanced = Elemental.balance(input.value, {quantifyResult: true});
        if(typeof balanced === 'string') return output.textContent = balanced;
        else {
            let mana = 0;

            let totalReactantProtons = 0;
            let totalReactantElectrons = 0;
            let totalReactantNeutrons = 0;

            let totalProductProtons = 0;
            let totalProductElectrons = 0;
            let totalProductNeutrons = 0;

            let productElements = Object.keys(balanced.products);
            let reactantElements = Object.keys(balanced.reactants);

            for(i = 0; i < productElements.length; i++){
                totalProductProtons += Elemental.protons(productElements[i]) * balanced.products[productElements[i]];
                totalProductElectrons += Elemental.electrons(productElements[i]) * balanced.products[productElements[i]];
                totalProductNeutrons += Elemental.neutrons(productElements[i]) * balanced.products[productElements[i]];
            }

            for(i = 0; i < reactantElements.length; i++){
                totalReactantProtons += Elemental.protons(reactantElements[i]) * balanced.reactants[reactantElements[i]];
                totalReactantElectrons += Elemental.electrons(reactantElements[i]) * balanced.reactants[reactantElements[i]];
                totalReactantNeutrons += Elemental.neutrons(reactantElements[i]) * balanced.reactants[reactantElements[i]];
            }

            totalProductProtons *= 20
            totalReactantProtons *= 20

            totalProductElectrons *= 20
            totalReactantElectrons *= 20

            totalProductNeutrons *= 20
            totalReactantNeutrons *= 20

            let protonDiff = totalProductProtons > totalReactantProtons ? totalProductProtons - totalReactantProtons : totalReactantProtons - totalProductProtons;
            protonDiff *= 20;

            let electronDiff = totalProductElectrons > totalReactantElectrons ? totalProductElectrons - totalReactantElectrons : totalReactantElectrons - totalProductElectrons;
            electronDiff *= 20;

            let neutronDiff = totalProductNeutrons > totalReactantNeutrons ? totalProductNeutrons - totalReactantNeutrons : totalReactantNeutrons - totalProductNeutrons;
            neutronDiff *= 20;

            protonDiff = protonDiff / 8;

            console.log(protonDiff, electronDiff, neutronDiff)

            mana = protonDiff + electronDiff + neutronDiff;

            if(mana < 0) mana = Math.abs(mana) / 2;

            mana = Math.round(mana)
            output.textContent = `Mana used: ${mana.toLocaleString()}`;
        }
    }

    document.body.appendChild(Utils.bundle([input, output]))
</script>