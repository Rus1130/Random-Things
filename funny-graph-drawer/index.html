<style>
    #chart {
        border: 1px solid black;
        /*
        make the width and height always the same
        */
        width: 500px;
        height: 500px;
        position: absolute;
        left: 5px;
        top: 25%;

        display: grid;
        grid-template-columns: repeat(60, 1fr);
        grid-template-rows: repeat(60, 1fr);  


    }
    #input {
        resize: none;
        width: 500px;
        height: 170px;
        position: absolute;
        left: 5px;
    }
    #input:focus {
        outline: none;
    }
</style>
<head>
    <script src="https://unpkg.com/mathjs@11.4.0/lib/browser/math.js"></script>
</head>
<body>
    <textarea id="input"></textarea>
    <div id="chart"></div>
</body>
<script>
    // make this a module
    const chart = document.getElementById("chart");

    const gradient = {
        lowest: {
            r: 255,
            g: 0,
            b: 0
        },
        highest: {
            r: 255,
            g: 255,
            b: 255,
        }
    }

    const cellMax = 60;
    // on window load
    window.onload = function() {
        for(y = cellMax; y > 0; y--) {
            for(x = 1; x < cellMax + 1; x++) {
                let div = document.createElement("div");
                div.style.backgroundColor = "white";
                div.setAttribute('chart-x', x);
                div.setAttribute('chart-y', y);
                div.setAttribute('answer', 'null');
                div.id = `${x},${y}`
                chart.appendChild(div);
            }
        }
        draw()
    }

    const equation = 'y = 2x'

    function getAnswers(){

        return new Promise(resolve => {
            let answers = {}

            for(y = cellMax; y > 0; y--) {
                for(x = 1; x < cellMax + 1; x++) {
                    // for every div, check if the equation is true (y should correspond to the div's chart-y attribute, and x should correspond to the div's chart-x attribute)
                    let div = document.querySelector(`div[chart-x="${x}"][chart-y="${y}"]`);
                    let answer = math.evaluate(equation, {x: x, y: y});
                    div.setAttribute('answer', answer);
                    answers[`${x},${y}`] = answer;
                }
            }
            resolve(answers);
        })
        draw()
    }

    async function draw(){
        let answers = await getAnswers();

        // color the background of each cell using a gradient and based on the answer
        for(y = cellMax; y > 0; y--) {
            for(x = 1; x < cellMax + 1; x++) {
                let div = document.querySelector(`div[chart-x="${x}"][chart-y="${y}"]`);
                let answer = div.getAttribute('answer');
                let color = getColor(answer);
                div.style.backgroundColor = color;
            }
        }
    }

    function getColor(input){
        let color = {
            r: 0,
            g: 0,
            b: 0
        }

        let lowest = gradient.lowest;
        let highest = gradient.highest;

        let range = {
            r: highest.r - lowest.r,
            g: highest.g - lowest.g,
            b: highest.b - lowest.b
        }

        let percent = input / cellMax;

        color.r = lowest.r + (range.r * percent);
        color.g = lowest.g + (range.g * percent);
        color.b = lowest.b + (range.b * percent);

        return `rgb(${color.r}, ${color.g}, ${color.b})`;
    }

</script>