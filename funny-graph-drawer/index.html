<style>
    #chart {
        border: 1px solid black;
        /*
        make the width and height always the same
        */
        width: 500px;
        height: 500px;
        position: absolute;
        left: 5px;
        top: 25%;

        display: grid;
        grid-template-columns: repeat(100, 1fr);
        grid-template-rows: repeat(100, 1fr);  
    }
    #input {
        resize: none;
        width: 500px;
        height: 170px;
        position: absolute;
        left: 5px;
    }
    #input:focus {
        outline: none;
    }
    #blocker {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        font-size: 100px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
</style>
<head>
    <script src="https://unpkg.com/mathjs@11.4.0/lib/browser/math.js"></script>
</head>
<body>
    <textarea id="input"></textarea>
    <div id="chart"></div>
</body>
<script>
    // make this a module
    const chart = document.getElementById("chart");
    const input = document.getElementById("input");

    const gradient = {
        lowest: {
            r: 255,
            g: 0,
            b: 0
        },
        highest: {
            r: 255,
            g: 255,
            b: 255,
        }
    }

    const cellMax = 100;
    const equation = 'min(1,max(0,20+20*((0.5+0.5*cos(5*atan2(column-50.5,row-50.5)))^0.3)-sqrt((column-50)^2+(row-50.5)^2)))+ min(1,max(0,19-sqrt((column-50.5)^2+(row-50.5)^2))) - 2*min(1,max(0,46-row))*min(1,max(0,2-abs(4-sqrt((row-45)^2+(abs(column-50)-6)^2)))) - 2*min(1,max(0,row-50))*min(1,max(0,2-abs(8-sqrt((column-50)^2+(row-50.5)^2))))';


    window.onload = function (){
        for(row = 1; row < cellMax + 1; row++) {
            for(column = 1; column < cellMax + 1; column++) {
                let div = document.createElement("div");
                div.setAttribute('column', column);
                div.setAttribute('row', row);
                chart.appendChild(div);
            }
        }
        draw()
    }
    

    function draw(){
        for(row = 1; row < cellMax + 1; row++) {
            for(column = 1; column < cellMax + 1; column++) {
                let div = document.querySelector(`div[column="${column}"][row="${row}"]`);
                div.setAttribute('answer', math.evaluate(equation, {column: column, row: row}));
            }
        }

        // get all the answers and the amount they appear
        let answers = {};
        let answerElements = document.querySelectorAll('[answer]');
        for(let i = 0; i < answerElements.length; i++) {
            let answer = answerElements[i].getAttribute('answer');
            if(answers[answer] == undefined) {
                answers[answer] = 1;
            } else {
                answers[answer]++;
            }
        }
        // using the gradient, get the color for each answer and color it's cell
        let answerKeys = Object.keys(answers);
        for(let i = 0; i < answerKeys.length; i++) {
            let answer = answerKeys[i];
            let color = getColor(answer, answerKeys[0], answerKeys[answerKeys.length - 1]);
            let elements = document.querySelectorAll(`[answer="${answer}"]`);
            for(let i = 0; i < elements.length; i++) {
                elements[i].style.backgroundColor = `rgb(${color.r}, ${color.g}, ${color.b})`;
            }
        }
    }

    function getColor(answer, lowest, highest) {
        let color = {
            r: 0,
            g: 0,
            b: 0
        }
        let answerRange = highest - lowest;
        let answerPercent = (answer - lowest) / answerRange;
        let gradientRange = gradient.highest.r - gradient.lowest.r;
        color.r = math.round(gradient.lowest.r + (gradientRange * answerPercent));
        gradientRange = gradient.highest.g - gradient.lowest.g;
        color.g = math.round(gradient.lowest.g + (gradientRange * answerPercent));
        gradientRange = gradient.highest.b - gradient.lowest.b;
        color.b = math.round(gradient.lowest.b + (gradientRange * answerPercent));
        return color;
    }


    // https://www.youtube.com/watch?v=JnCkF62gkOY

</script>