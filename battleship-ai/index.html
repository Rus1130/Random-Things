<style>
    #wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
    }

    #gameboard {
        display: grid;
        width: 890px;
        height: 450px;
        grid-template-columns: 440px 440px;
        grid-gap: 32px;
    }

    #dialogue-box-wrapper {
        position: absolute;
        left: 50%;
        transform: translateX(calc(-50% + 11px));
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1;
    }

    #dialogue-box {
        border: 1px solid black;
        display: flex;
        justify-content: center;
        align-items: center;
        width: 910px;
        height: 157px;
        font-family: monospace;
        font-size: 50px;
    }

</style>
<head>
    <script src="two.js"></script>
</head>
<body>
    <div id="dialogue-box-wrapper">
        <div id="dialogue-box"></div>
    </div>
    <div id="wrapper">
        <div id="gameboard">
            <div id='shipsWrapper'></div>
            <div id='radarWrapper'></div>
        </div>
    </div>
</body>
<script>
    let gameState = 0;

    let enemyShips = {};
    let enemyRadar = {};
    let letters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
    let numbers = {
        'A': 1,
        'B': 2,
        'C': 3,
        'D': 4,
        'E': 5,
        'F': 6,
        'G': 7,
        'H': 8,
        'I': 9,
        'J': 10
    }

    const mouse = {
        x: 0,
        y: 0
    }

    let placingDirection = 'x'
    let currentlyPlacingShip = 0

    // Carrier, Battleship, Cruiser, Submarine, Destroyer

    const shipCells = []

    const data = {
        hoveredCell: undefined,
        previousHoveredCell: undefined,
        hoveredCellTimeline: []
    }

    const placingData = {
        Carrier: [],
        Battleship: [],
        Cruiser: [],
        Submarine: [],
        Destroyer: []
    }

    const gameboard = document.getElementById('gameboard');
    const shipsWrapper = document.getElementById('shipsWrapper');
    const radarWrapper = document.getElementById('radarWrapper');

    let twoShips = new Two({
        width: 440,
        height: 440,
        autostart: true
    }).appendTo(shipsWrapper);

    let twoRadar = new Two({
        width: 440,
        height: 440,
        autostart: true
    }).appendTo(radarWrapper);

    for(i = 0; i < 11; i++){
        for(j = 0; j < 11; j++){
            let shipCell = twoShips.makeRectangle((i * 40) + 20, (j * 40) + 20, 40, 40);
            let radarCell = twoRadar.makeRectangle((i * 40) + 20, (j * 40) + 20, 40, 40);

            shipCell.cellType = 'ship';
            radarCell.cellType = 'radar';

            if(i == 0 || j == 0){
                if(j == 0) shipCell.id =  `start_${i}`;
                if(j == 0) radarCell.id =  `start_${i}`;

                if(i == 0) shipCell.id =  `start_${letters[j - 1]}`;
                if(i == 0) radarCell.id =  `start_${letters[j - 1]}`;

                if(shipCell.id == 'start_undefined') shipCell.id = 'start_*';
                if(radarCell.id == 'start_undefined') radarCell.id = 'start_*';

                if(j == 0 && i != 0){
                    let shipCellText = twoShips.makeText(i, (i * 40) + 20, (j * 40) + 22);
                    let radarCellText = twoRadar.makeText(i, (i * 40) + 20, (j * 40) + 22);

                    shipCellText.family = 'monospace';
                    radarCellText.family = 'monospace';

                    shipCellText.size = 20;
                    radarCellText.size = 20;
                }

                if(i == 0 && j != 0){
                    let shipCellText = twoShips.makeText(letters[j - 1], (i * 40) + 20, (j * 40) + 22);
                    let radarCellText = twoRadar.makeText(letters[j - 1], (i * 40) + 20, (j * 40) + 22);

                    shipCellText.family = 'monospace';
                    radarCellText.family = 'monospace';

                    shipCellText.size = 20;
                    radarCellText.size = 20;
                }
            }

            if(j != 0 && i != 0){
                shipCell.id = `${letters[j - 1]}${i}`;
                radarCell.id = `${letters[j - 1]}${i}`;

                let shipPin = twoShips.makeCircle((i * 40) + 20, (j * 40) + 20, 6);
                shipPin.id = `pin_ship-${shipCell.id}`;
                shipPin.fill = 'black';
                shipPin.opacity = 0.5;
                shipPin.noStroke();

                let radarPin = twoRadar.makeCircle((i * 40) + 20, (j * 40) + 20, 6);
                radarPin.id = `pin_radar-${radarCell.id}`;
                radarPin.fill = 'black';
                radarPin.opacity = 0.5;
                radarPin.noStroke();
                
            }

            shipCell.backgroundSetDefault = 'grey'
            shipCell.backgroundResetDefault = 'white';

            shipCells.push(shipCell);

            shipCell.id = "ship-" + shipCell.id;
            radarCell.id = "radar-" + radarCell.id;
            
        }
    }

    gameboard.onmousemove = e => {
        mouse.x = e.clientX;
        mouse.y = e.clientY;
    }

    function setHoveredCell(filter){
        cell = document.elementFromPoint(mouse.x, mouse.y);
        if(cell.id.split("-")[0] == filter){
            data.hoveredCell = cell;
        }
    }



    twoShips.bind('update', function(frameCount){
        if(gameState == 0){
            setHoveredCell('ship');
            let hoveredCellID = data.hoveredCell == undefined ? undefined : data.hoveredCell.id

            if(data.hoveredCell !== undefined){

                let shipParts = [data.hoveredCell.id.split("-")[1].split(""), data.hoveredCell.id.split("-")[1].split(""), data.hoveredCell.id.split("-")[1].split(""), data.hoveredCell.id.split("-")[1].split("")]

                if(data.hoveredCell.id.split("_")[0] != "ship-start"){
                    if(placingDirection == 'x'){

                        shipParts[0][0] += "+";
                        shipParts[1][0] += "+";
                        shipParts[2][0] += "+";
                        shipParts[3][0] += "+";

                        shipParts[0] = shipParts[0].join("").split("+");
                        shipParts[1] = shipParts[1].join("").split("+");
                        shipParts[2] = shipParts[2].join("").split("+");
                        shipParts[3] = shipParts[3].join("").split("+");

                        shipParts[0][1] = +shipParts[0][1] - 2;
                        shipParts[1][1] = +shipParts[1][1] - 1;
                        shipParts[2][1] = +shipParts[2][1] + 1;
                        shipParts[3][1] = +shipParts[3][1] + 2;

                        shipParts[0] = shipParts[0].join("")
                        shipParts[1] = shipParts[1].join("")
                        shipParts[2] = shipParts[2].join("")
                        shipParts[3] = shipParts[3].join("")

                        shipParts[0] = document.getElementById("ship-" + shipParts[0]);
                        shipParts[1] = document.getElementById("ship-" + shipParts[1]);
                        shipParts[2] = document.getElementById("ship-" + shipParts[2]);
                        shipParts[3] = document.getElementById("ship-" + shipParts[3]);

                    }
                }
                data.hoveredCellTimeline.push(data.hoveredCell);
                if(data.hoveredCellTimeline.length > 3){
                    data.hoveredCellTimeline.shift();
                }

                if(data.hoveredCellTimeline[1] !== data.hoveredCell){
                    data.previousHoveredCell = data.hoveredCellTimeline[1];
                }

                let cell = shipCells.find(cell => cell.id == data.hoveredCell.id);


                if(data.previousHoveredCell !== undefined){
                    if(data.hoveredCell.id.split("_")[0] != "ship-start"){
                        data.hoveredCell.style.fill = cell.backgroundSetDefault
                    }

                    data.previousHoveredCell.style.fill = cell.backgroundResetDefault


                    if(document.elementFromPoint(mouse.x, mouse.y).id.split("-")[0] != 'ship' &&
                        document.elementFromPoint(mouse.x, mouse.y).id.split("-")[0] != 'pin_ship'){
                        data.hoveredCell.style.fill = cell.backgroundResetDefault
                    }




                    




                }
            }
        }


    }).play();



</script>