<style>
    .button {
        outline: 1px black solid;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        height: 30px;
        width: 100px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }
</style>
<head>

</head>
<body>
    <div id="rootBridgeDisplay"></div>
    <br>
    <div class="button" onclick="calculate()">Calculate STP</div>
</body>
<script>
    const rootBridgeDisplay = document.getElementById('rootBridgeDisplay');
    let devices = {};
    /*
        SW4: {
            priority: 32769,
            rootBridge: false,
            MACaddress: '83F1.2846.392F',
            ports: {
                'g0/0': {
                    thisDevice: 'SW4',
                    thisPort: 'g0/0',
                    thisPortType: null,

                    connectedDevice: 'SW3',
                    connectedPort: 'g0/1'
                },
                'g0/1': {
                    thisDevice: 'SW4',
                    thisPort: 'g0/1',
                    thisPortType: null,

                    connectedDevice: 'SW2',
                    connectedPort: 'g0/0'
                }	
            }
        }
        addDevice('SW4', 32769, '83F1.2846.392F', [generatePortModel("SW4", "g0/0", 'SW3', "g0/1"), generatePortModel("SW4", "g0/1", "SW2", "g0/0")]);
    */

    // get the device with the lowest priority, if all priorities are the same, get the device with the lowest MAC address
    function getRootDevice() {
        let rootDevice = null;
        let rootPriority = 65535;
        let rootMAC = 'FFFF.FFFF.FFFF';

        for (let device in devices) {
            if (devices[device].priority < rootPriority) {
                rootDevice = device;
                rootPriority = devices[device].priority;
                rootMAC = devices[device].MACaddress;
            } else if (devices[device].priority == rootPriority) {
                if (devices[device].MACaddress < rootMAC) {
                    rootDevice = device;
                    rootPriority = devices[device].priority;
                    rootMAC = devices[device].MACaddress;
                }
            }
        }

        return rootDevice;
    }
    
    function generatePortModel(thisDevice, thisPort, connectedDevice, connectedPort) {

        return {[thisPort] : {
            thisDevice: thisDevice,
            thisPort: thisPort,
            thisPortType: null,

            connectedDevice: connectedDevice,
            connectedPort: connectedPort,
        }};
    }


    function addDevice(device, priority, MACaddress, ports) {
        devices[device] = {
            priority: priority,
            rootBridge: false,
            MACaddress: MACaddress,
            ports: ports.reduce((acc, port) => {
                return {...acc, ...port};
            }, {})
        }
        
        
    }

    function calculate(){
        let rootBridge = getRootDevice();
        devices[rootBridge].rootBridge = true;

        let rootPorts = {}

        for (let device in devices) {
            if(devices[device].rootBridge) continue;
            let rootPort = null;
            let rootPriority = 65535;
            let rootMAC = 'FFFF.FFFF.FFFF';

            // calculate the root port for each device using the lowest root cost, low
            for (let port in devices[device].ports) {
                let connectedDevice = devices[device].ports[port].connectedDevice;
                let connectedPort = devices[device].ports[port].connectedPort;

                if (devices[connectedDevice].priority < rootPriority) {
                    rootPort = port;
                    rootPriority = devices[connectedDevice].priority;
                    rootMAC = devices[connectedDevice].MACaddress;
                } else if (devices[connectedDevice].priority == rootPriority) {
                    if (devices[connectedDevice].MACaddress < rootMAC) {
                        rootPort = port;
                        rootPriority = devices[connectedDevice].priority;
                        rootMAC = devices[connectedDevice].MACaddress;
                    }
                }
            }
            


            rootPorts[device] = rootPort

        }
        rootBridgeDisplay.innerHTML = `The root bridge is ${rootBridge}.`;
        console.log(rootPorts)
    }
    // this device, this port, connected device, connected port
    addDevice('SW1', 32769, '014A.38F1.B8A1', [
        generatePortModel("SW1", "g0/0", 'SW2', "g0/2"), 
        generatePortModel("SW1", "g0/1", "SW3", "g0/0"),
        generatePortModel("SW1", "g0/2", "SW2", "g0/1"),
    ]);
    addDevice('SW2', 32769, '193D.72DE.36E1', [
        generatePortModel("SW2", "g0/0", 'SW4', "g0/1"), 
        generatePortModel("SW2", "g0/1", "SW1", "g0/2"),
        generatePortModel("SW2", "g0/2", "SW1", "g0/0"),
    ]);
    addDevice('SW3', 32769, '014A.3821.2981', [
        generatePortModel("SW3", "g0/0", 'SW1', "g0/1"), 
        generatePortModel("SW3", "g0/1", "SW4", "g0/0"),
    ]);
    addDevice('SW4', 32769, '83F1.2846.392F', [
        generatePortModel("SW4", "g0/0", 'SW3', "g0/1"), 
        generatePortModel("SW4", "g0/1", "SW2", "g0/0")
    ]);	
    console.log(devices)


    // file:///C:/Users/aarogozin2026/Downloads/STP_Spanning_Tree_Protocol.pdf
    // https://techhub.hpe.com/eginfolib/networking/docs/switches/7500/5200-1938a_l2-lan_cg/content/495503520.htm

</script>