<style>
    img {
        -webkit-user-drag: none;
        user-select: none;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
        position: absolute;
    }
</style>
<head>

</head>
<body>
    Click the lemons!
    <div id="points">Points: 0</div>
    <div id="lives">Lives: 3</div>
    <div id="seconds">Time Played: 0s</div>
    <div id="gamearea">
        <img id="lemon" src="imgs/lemon.png" onclick="lemonPos()" style="position: absolute;"></img>
    </div>
    
    <div id="debug"></div>
</body>
<script>

    const imgsArray = ['lime', 'orange', 'mango', 'banana']

    const pointDisplay = document.getElementById("points");
    const livesDisplay = document.getElementById("lives");
    const timeDisplay = document.getElementById("seconds");
    const debug = document.getElementById("debug");
    const lemon = document.getElementById("lemon");

    const gameArea = document.getElementById("gamearea");

    // plans:
    // make different size pngs for different size screens

    const edgeClearence = 200;
    const settings = {
        playing: true,
        time: 0,
        score: 0,
        points: 0,
        lives: 3,
        lifeAddThreshold: 40,
        lowerX: edgeClearence,
        lowerY: edgeClearence,
        upperX: window.innerWidth - edgeClearence,
        upperY: window.innerHeight - edgeClearence,
        showDebug: false,
        debug: {
            position: '',
            time: 0,
        },
        objectTracker: {
            lime: 0,
            orange: 0,
            mango: 0,
            banana: 0,
        },
        children: 1,
        damageDB: {
            lime: 1,
            orange: 1,
            mango: 1,
            banana: 2,
        },
        objects: {
            0: {
                passed: false,
                score: 5,
                passFunction: function() {
                    if(this.passed == false && settings.score >= this.score){
                        createNewObject('lime')
                        this.passed = true
                    }
                },
            },
            1: {
                passed: false,
                score: 10,
                passFunction: function() {
                    if(this.passed == false && settings.score >= this.score){
                        createNewObject('lime')
                        this.passed = true
                    }
                },
            },
            2: {
                passed: false,
                score: 20,
                passFunction: function() {
                    if(this.passed == false && settings.score >= this.score){
                        createNewObject('orange')
                        this.passed = true
                    }
                },
            },
            3: {
                passed: false,
                score: 25,
                passFunction: function() {
                    if(this.passed == false && settings.score >= this.score){
                        createNewObject('orange')
                        this.passed = true
                    }
                },
            },
            4: {
                passed: false,
                score: 30,
                passFunction: function() {
                    if(this.passed == false && settings.score >= this.score){
                        createNewObject('mango')
                        this.passed = true
                    }
                },
            },
            5: {
                passed: false,
                score: 35,
                passFunction: function() {
                    if(this.passed == false && settings.score >= this.score){
                        createNewObject('mango')
                        this.passed = true
                    }
                },
            },
            6: {
                passed: false,
                score: 40,
                passFunction: function() {
                    if(this.passed == false && settings.score >= this.score){
                        createNewObject('banana')
                        this.passed = true
                    }
                },
            },
            7: {
                passed: false,
                score: 45,
                passFunction: function() {
                    if(this.passed == false && settings.score >= this.score){
                        createNewObject('banana')
                        this.passed = true
                    }
                },
            },
        }
    }

    function randomNum(min, max) {
        let coordinate = Math.floor(Math.random() * (max - min + 1) + min);
        return coordinate;
    }


    function lemonPos(increaseScore){
        if(increaseScore == undefined) increaseScore = true;
        let randX = randomNum(settings.lowerX, settings.upperX);
        let randY = randomNum(settings.lowerY, settings.upperY);
        let randZ = randomNum(1, 75);
        lemon.style.top = randY + "px";
        lemon.style.left = randX + "px";
        lemon.style.zIndex = randZ;


        if(increaseScore){
            settings.score += 1;
            settings.points += 1;
        }
        if(settings.score % settings.lifeAddThreshold == 0 && settings.score != 0) settings.lives += 1;
    
        for(i = 0; i < gameArea.children.length; i++){
            if(gameArea.children[i].id == 'lemon') continue
            document.getElementById(gameArea.children[i].id).style.top = randomNum(settings.lowerY, settings.upperY) + "px";
            document.getElementById(gameArea.children[i].id).style.left = randomNum(settings.lowerX, settings.upperX) + "px";
            document.getElementById(gameArea.children[i].id).style.zIndex = randomNum(1, 50);
        }

        settings.debug.position = `${randX}, ${randY}`
    }


    function updatePos(name, damage){
        document.getElementById(name).style.top = randomNum(settings.lowerY, settings.upperY) + "px";
        document.getElementById(name).style.left = randomNum(settings.lowerX, settings.upperX) + "px";
        lemonPos(false)
        settings.lives -= damage
        if(settings.lives <= 0) settings.lives = 0;
    }

    function createNewObject(name){
        let newObject = document.createElement("img");
        newObject.src = `imgs/${name}.png`;
        newObject.style.position = "absolute";
        newObject.style.top = randomNum(settings.lowerY, settings.upperY) + "px";
        newObject.style.left = randomNum(settings.lowerX, settings.upperX) + "px";
        newObject.id = `${name}${settings.objectTracker[name]}`
        settings.objectTracker[name] += 1;
        gameArea.appendChild(newObject);
    }


    // make sure there are no overlapping images

    lemonPos(false)
    createNewObject('lime')
    setInterval(() => {
        if(settings.playing){
            settings.time++;
            pointDisplay.innerHTML = `Points: ${settings.points}`;
            livesDisplay.innerHTML = `Lives: ${settings.lives}`;
            timeDisplay.innerHTML = `Time Played: ${settings.time / 10}s`;

            settings.debug.time++;
            settings.upperX = window.innerWidth - 300
            settings.upperY = window.innerHeight - 300

            if(settings.showDebug) debug.innerHTML =
            `Lemon Position: ${settings.debug.position}<br>` + 
            `Ticks: ${settings.debug.time}<br>` +
            `Objects: ${JSON.stringify(settings.objectTracker)}` // make this look pretty

            if(settings.children != gameArea.children.length){
                for(i = 0; i < gameArea.children.length; i++){
                    if(gameArea.children[i].id == 'lemon') continue
                    let childDamage = settings.damageDB[gameArea.children[i].id.replaceAll(/[0-9]/g, '')]
                    document.getElementById(gameArea.children[i].id).setAttribute("onclick", `updatePos('${gameArea.children[i].id}', ${childDamage})`)
                }
                settings.children++
            }
            for(i = 0; i < Object.keys(settings.objects).length; i++){
                let objects = Object.keys(settings.objects)
                settings.objects[objects[i]].passFunction()
            }

            // add one life every time the score is a multiple of 10
            if(settings.lives == 0) settings.playing = false;
        } else {
            let gameOverAlert = confirm(`You lost! Your score was ${settings.score}, and you played for ${settings.time / 10} seconds!\nPress 'ok' to play again.`);
            if(gameOverAlert){
                settings.playing = true;
                settings.time = 0;
                settings.score = 0;
                settings.points = 0;
                settings.lives = 3;
                for(i = 0; i < Object.keys(settings.objects).length; i++){
                    let objects = Object.keys(settings.objects)
                    settings.objects[objects[i]].passed = false
                }
                // get array of all children
                let children = Array.from(gameArea.children)
                children.forEach(child => {
                    if(child.id == 'lemon') return
                    gameArea.removeChild(child)
                    lemonPos(false)
                })

            } else {
                let thanksForPlaying = alert(`⢥⢫⡜⢣⡝⢦⡙⢦⣢⣤⣴⢬⣤⣥⣄⣀⣀⣢⣵⣶⣬⣤⣀⡀⠠⠀⢀⠈⠣⡈
⢎⡳⡜⣣⢞⡣⣽⠟⢩⣿⣿⣶⡄⠀⣹⡿⣿⠁⣴⣿⣿⣧⡉⠻⣶⠀⠀⠂⠄⠱
⡝⣲⠹⣔⢣⠳⣼⣿⡘⠿⣿⡿⠃⣰⡿⢀⠻⣧⠙⡿⣿⠟⠁⣰⡟⠀⠄⢈⠐⡈
⡜⢥⡛⣬⢣⡛⣤⢛⠿⢷⡶⣴⣾⡿⢶⡥⣖⣹⣟⠳⠶⠶⠿⠋⠀⡀⠂⡀⠂⠐
⡜⢣⡓⢦⢣⡝⢢⢏⠞⣰⣿⣿⣿⣿⣿⢾⣵⣾⣻⢿⣆⡀⠐⠀⠂⠀⠀⠄⠁⠂
⡜⣣⢝⡪⢵⡘⣣⠎⣼⣿⣿⣿⣿⣿⣿⣻⣯⣿⣿⣿⣿⡿⠀⠀⠀⠀⠀⡘⠠⢀
⡜⢥⢎⡵⢣⢣⡕⢪⠄⡉⠘⠉⠘⠻⠿⡟⠟⠁⠋⠋⠁⠀⠀⠀⠀⠀⠁⠀⢂⠄
⡜⣊⠞⡴⣋⠶⣘⢣⠚⡄⡁⠂⠡⠀⠄⡀⠄⠂⠁⠀⠀⠀⠀⠀⠀⠀⠄⢁⠂⠄
im watching you`);
                if(thanksForPlaying == undefined){
                    window.close();
                }
            }
        }
    }, 100)
    
    
</script>